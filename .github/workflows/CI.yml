name: CI

on:
  push:

jobs:
  build-check-code:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Just
        uses: extractions/setup-just@v2

      - name: Install ninja
        uses: seanmiddleditch/gha-setup-ninja@master

      - name: Install dependencies
        run: |
          sudo add-apt-repository universe
          sudo apt update
          sudo apt install libboost-all-dev=1.83.0.1ubuntu2 doxygen xorg-dev graphviz libharfbuzz-dev libfreetype6-dev libxcb1-dev libxcb-util-dev libxcb-xkb-dev

      - name: Install tools
        run: |
          sudo apt install clang-format clang-tidy cppcheck

      - name: Trick CMake into thinking Skia is already built
        run: |
          mkdir -p build/_deps/skia/out/Release
          touch build/_deps/skia/out/Release/libskia.a

      - name: Run static code analysis with cppcheck
        run: cppcheck --enable=all --inconclusive --quiet --max-configs=10000 .

      - name: Check clang-format
        run: just check-clang-format

      - name: Run clang-tidy
        run: just clang-tidy
